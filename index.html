<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Asistencia NFC</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
        table { border-collapse: collapse; width: 100%; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; }
        th { background-color: #4CAF50; color: white; }
    </style>
</head>
<body>
    <h1>Registro de Asistencia NFC</h1>
    <button id="startBtn">Iniciar lectura</button>
    <p id="status"></p>

    <table id="tablaRegistros">
        <thead>
            <tr>
                <th>Tarjeta</th>
                <th>Fecha y Hora</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>
        // Cargar registros guardados
        const registros = JSON.parse(localStorage.getItem("asistencias")) || [];
        actualizarTabla();

        document.getElementById("startBtn").addEventListener("click", async () => {
            if ("NDEFReader" in window) {
                try {
                    const ndef = new NDEFReader();
                    document.getElementById("status").textContent = "Esperando tarjeta...";
                    await ndef.scan();

                    ndef.onreading = event => {
                        const id = event.serialNumber || "No disponible";
                        const fecha = new Date().toLocaleString();

                        // Guardar en array y en localStorage
                        registros.push({ tarjeta: id, fecha: fecha });
                        localStorage.setItem("asistencias", JSON.stringify(registros));

                        document.getElementById("status").textContent = `Registrado: ${id} - ${fecha}`;
                        actualizarTabla();
                    };
                } catch (error) {
                    document.getElementById("status").textContent = "Error: " + error;
                }
            } else {
                alert("Tu navegador no soporta Web NFC (usa Chrome en Android).");
            }
        });

        function actualizarTabla() {
            const tbody = document.querySelector("#tablaRegistros tbody");
            tbody.innerHTML = "";
            registros.forEach(r => {
                const fila = `<tr><td>${r.tarjeta}</td><td>${r.fecha}</td></tr>`;
                tbody.innerHTML += fila;
            });
        }
    </script>
</body>
</html>
